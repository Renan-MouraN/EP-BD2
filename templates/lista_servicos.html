<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nossos Servi√ßos - PataCerta</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary: #6C63FF;
            --secondary: #5850D8;
            --dark: #2E3056;
            --light: #F4F6FC;
            --accent: #FF6B6B;
        }
        
        body {
            background-color: var(--light);
            color: var(--dark);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Header */
        header {
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }
        
        .logo {
            display: flex;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
            text-decoration: none;
        }
        
        .logo-icon {
            font-size: 28px;
            margin-right: 8px;
        }
        
        .nav-links {
            display: flex;
            list-style: none;
            gap: 10px;
            align-items: center;
        }
        
        .nav-links a {
            text-decoration: none;
            color: var(--dark);
            font-weight: 500;
            padding: 8px 12px;
            display: flex;
            align-items: center;
        }
        
        .nav-links a:hover:not(.btn) {
            color: var(--primary);
        }

        .hidden {
            display: none !important;
        }
        
        .btn {
            padding: 10px 20px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
        }
        
        .btn:hover {
            background-color: #5850D8;
        }
        
        .btn-secondary { background-color: var(--secondary); }
        .btn-danger { background-color: var(--accent); }
        .btn-outline { background-color: transparent; border: 2px solid #ccc; color: var(--dark); }
        .btn-outline:hover { background-color: var(--light); }

        .page-header {
            text-align: center;
            padding: 40px 20px;
        }
        
        .page-header h1 {
            font-size: 42px;
            color: var(--dark);
        }
        
        .page-header p {
            font-size: 18px;
            color: #555;
            max-width: 600px;
            margin: 10px auto 0;
        }

        .admin-controls {
            background-color: white;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Admin Table View */
        .admin-view table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .admin-view th, .admin-view td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        .admin-view th {
            background-color: var(--primary);
            color: white;
        }
        .admin-view tr:nth-child(even) { background-color: #f8f9fa; }
        .admin-view .action-buttons { display: flex; gap: 10px; }

        /* Public Grid View */
        .public-view {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
        }

        .service-card {
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 15px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            padding: 25px;
            text-align: center;
        }
        .service-card:hover { transform: translateY(-5px); box-shadow: 0 8px 25px rgba(0,0,0,0.1); }
        .service-icon { font-size: 48px; color: var(--primary); margin-bottom: 15px; }
        .service-card h3 { font-size: 22px; color: var(--dark); margin-bottom: 10px; }
        .service-desc { color: #777; flex-grow: 1; margin-bottom: 20px; }
        .service-price { font-size: 24px; font-weight: 700; color: var(--primary); margin-bottom: 20px; }
        
        /* Filter Form */
        .filter-section {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
            margin-bottom: 40px;
        }
        .filter-form {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 15px;
            align-items: center;
        }
        .filter-form select {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: white;
            width: 100%;
        }
        .filter-buttons {
            display: flex;
            gap: 15px;
        }
        
    </style>
</head>
<body>
    <header>
        <div class="container">
            <nav class="navbar">
                <a href="index.html" class="logo"><i class="logo-icon">üêæ</i> Pata<span>Certa</span></a>
                <ul class="nav-links">
                    <li><a href="index.html">In√≠cio</a></li>
                    <li><a href="lista_animais.html">Animais</a></li>
                    <li><a href="lista_produtos.html">Produtos</a></li>
                    <li><a href="lista_servicos.html">Servi√ßos</a></li>
                    <li id="nav-admin" class="hidden"><a href="admin.html" class="btn">Painel Admin</a></li>
                    <li id="nav-logged-out"><a href="login.html" class="btn btn-outline">Login</a></li>
                    <li id="nav-logged-out-2"><a href="login.html" class="btn">Cadastre-se</a></li>
                    <li id="nav-logged-in" class="hidden"><a href="meu_perfil.html">Meu Perfil</a></li>
                    <li id="nav-logged-in-2" class="hidden"><a href="#" id="logout-btn" class="btn btn-secondary">Sair</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="container">
        <div class="page-header">
            <h1 id="page-title">Nossos Servi√ßos</h1>
            <p id="page-subtitle">Cuidado profissional e carinho para o seu melhor amigo.</p>
        </div>

        <!-- Filter Section -->
        <section class="filter-section">
             <form class="filter-form" id="filter-form">
                <select name="categoria" id="categoria-select">
                    <option value="">Todas as Categorias</option>
                    <!-- Op√ß√µes ser√£o preenchidas por JS -->
                </select>
                <div class="filter-buttons">
                    <button type="submit" class="btn">Buscar</button>
                    <button type="button" id="clear-filters-btn" class="btn btn-outline">Limpar</button>
                </div>
            </form>
        </section>

        <!-- Admin Controls -->
        <div id="admin-controls" class="admin-controls hidden">
            <h2>Gest√£o de Servi√ßos</h2>
            <a href="form_servico.html" class="btn btn-primary">+ Adicionar Novo Servi√ßo</a>
        </div>

        <!-- Admin View -->
        <div id="admin-view" class="admin-view hidden">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nome</th>
                        <th>Pre√ßo Base</th>
                        <th>Dura√ß√£o (min)</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="admin-table-body"></tbody>
            </table>
        </div>

        <!-- Public View -->
        <div id="public-view" class="public-view">
            <!-- Cards de servi√ßos ser√£o inseridos aqui -->
        </div>
    </main>

    <script>
        const API_BASE_URL = 'http://127.0.0.1:8000';
        let currentUser = null;
        let allServices = [];

        const serviceIcons = {
            'Banho': 'üõÅ', 'Tosa': '‚úÇÔ∏è', 'Consulta': 'ü©∫', 'Vacina√ß√£o': 'üíâ',
            'Passeio': 'üêï', 'Adestramento': 'üéì', 'Hospedagem': 'üè®', 'Creche': 'üß∏',
            'Padr√£o': '‚≠ê'
        };

        function getIconForService(serviceName) {
            for (const key in serviceIcons) {
                if (serviceName.toLowerCase().includes(key.toLowerCase())) {
                    return serviceIcons[key];
                }
            }
            return serviceIcons['Padr√£o'];
        }

        function updateUIForLoginState() {
            const navAdmin = document.getElementById('nav-admin');
            const navProfile = document.getElementById('nav-logged-in');
            const navLogout = document.getElementById('nav-logged-in-2');
            const navLoggedOut = document.querySelectorAll('#nav-logged-out, #nav-logged-out-2');
            
            const userData = JSON.parse(localStorage.getItem('patacerta_user'));
            currentUser = userData;

            navAdmin.classList.add('hidden');
            navProfile.classList.add('hidden');
            navLogout.classList.add('hidden');
            navLoggedOut.forEach(el => el.classList.add('hidden'));

            if (userData && userData.nome) {
                navLogout.classList.remove('hidden');
                if (userData.is_admin) {
                    navAdmin.classList.remove('hidden');
                } else {
                    navProfile.classList.remove('hidden');
                }
            } else {
                navLoggedOut.forEach(el => el.classList.remove('hidden'));
            }
        }

        function handleLogout() {
            localStorage.removeItem('patacerta_user');
            alert("Voc√™ saiu da sua conta.");
            window.location.reload();
        }

        function renderPublicView(services) {
            const grid = document.getElementById('public-view');
            grid.innerHTML = '';
            if (services.length === 0) {
                grid.innerHTML = '<p>Nenhum servi√ßo encontrado com os filtros selecionados.</p>';
                return;
            }
            services.forEach(service => {
                const card = document.createElement('div');
                card.className = 'service-card';
                const icon = getIconForService(service.nome);

                card.innerHTML = `
                    <div class="service-icon">${icon}</div>
                    <h3>${service.nome}</h3>
                    <p class="service-desc">${service.descricao || 'Servi√ßo especializado para o bem-estar do seu pet.'}</p>
                    <div class="service-price">R$ ${parseFloat(service.preco_base || 0).toFixed(2)}</div>
                    <a href="#" class="btn">Agendar Agora</a>
                `;
                grid.appendChild(card);
            });
        }

        function renderAdminView(services) {
            const tableBody = document.getElementById('admin-table-body');
            tableBody.innerHTML = '';
            services.forEach(service => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${service.id_servico}</td>
                    <td>${service.nome}</td>
                    <td>R$ ${parseFloat(service.preco_base || 0).toFixed(2)}</td>
                    <td>${service.duracao_minutos || 'N/A'}</td>
                    <td class="action-buttons">
                        <a href="form_servico.html?id=${service.id_servico}" class="btn btn-secondary">Editar</a>
                        <button onclick="deleteService(${service.id_servico})" class="btn btn-danger">Excluir</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        function displayResults(services) {
            const isAdmin = currentUser && currentUser.is_admin;
            if (isAdmin) {
                renderAdminView(services);
            } else {
                renderPublicView(services);
            }
        }

        async function deleteService(serviceId) {
            if (!currentUser || !currentUser.is_admin) return alert("Apenas administradores podem excluir servi√ßos.");
            if (!confirm(`Tem a certeza que deseja excluir o servi√ßo com ID ${serviceId}?`)) return;

            try {
                const response = await fetch(`${API_BASE_URL}/servicos/${serviceId}?userId=${currentUser.id_usuario}`, { method: 'DELETE' });
                const result = await response.json();
                if (!response.ok) throw new Error(result.detail);
                alert("Servi√ßo exclu√≠do com sucesso!");
                initializeApp();
            } catch (error) {
                alert(`Erro ao excluir: ${error.message}`);
            }
        }
        
        function populateCategoryFilter(services) {
            const categories = [...new Set(services.map(s => s.categoria).filter(Boolean))];
            const select = document.getElementById('categoria-select');
            categories.sort().forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat.charAt(0).toUpperCase() + cat.slice(1);
                select.appendChild(option);
            });
        }

        function handleFilterSubmit(event) {
            event.preventDefault();
            const selectedCategory = document.getElementById('categoria-select').value;
            let filteredServices = allServices;

            if (selectedCategory) {
                filteredServices = allServices.filter(s => s.categoria === selectedCategory);
            }
            
            document.getElementById('page-title').textContent = selectedCategory ? `Mostrando: ${selectedCategory}` : 'Todos os Servi√ßos';
            displayResults(filteredServices);
        }

        function clearFilters() {
            document.getElementById('filter-form').reset();
            document.getElementById('page-title').textContent = 'Nossos Servi√ßos';
            displayResults(allServices);
        }

        async function initializeApp() {
            updateUIForLoginState();
            
            const isAdmin = currentUser && currentUser.is_admin;
            document.getElementById('admin-controls').classList.toggle('hidden', !isAdmin);
            document.getElementById('admin-view').classList.toggle('hidden', !isAdmin);
            document.getElementById('public-view').classList.toggle('hidden', isAdmin);
            
            const targetView = isAdmin ? document.getElementById('admin-table-body') : document.getElementById('public-view');
            targetView.innerHTML = isAdmin ? '<tr><td colspan="5" style="text-align:center;">A carregar...</td></tr>' : '<p>A carregar...</p>';

            try {
                const response = await fetch(`${API_BASE_URL}/servicos/?limit=100`);
                if (!response.ok) throw new Error("N√£o foi poss√≠vel carregar os dados dos servi√ßos.");
                allServices = await response.json();
                
                populateCategoryFilter(allServices);
                displayResults(allServices);

            } catch (error) {
                targetView.innerHTML = `<p style="color:red; text-align:center;">${error.message}</p>`;
            }
        }

        document.addEventListener('DOMContentLoaded', initializeApp);
        document.getElementById('filter-form').addEventListener('submit', handleFilterSubmit);
        document.getElementById('clear-filters-btn').addEventListener('click', clearFilters);
        
        const logoutBtn = document.getElementById('logout-btn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', handleLogout);
        }
    </script>
</body>
</html>
